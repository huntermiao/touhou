{% extends 'common/base.html' %}
{% load staticfiles %}
{% block top %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/themes/flat-blue.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
{% endblock %}
{% block title %}用户首页{% endblock %}
{% block boday %}
    <div class="flat-blue">
        <div class="app-container">
            <div class="row content-container">
                {% include 'common/nav.html' %}
                {% include 'common/sidebar.html'  %}

                <!-- Main Content -->
            <div class="side-body" id = 'vue'>
                    <div class="page-title">
                        <span class="title">用户数据录入</span>
                        <div class="description">通过上传数据进行用户批量数据录入</div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="card">
                                <div class="card-header">

                                    <div class="card-title">
                                    <div class="title">列表</div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="DataTables_Table_0_wrapper" class="dataTables_wrapper form-inline dt-bootstrap">
                                        <div class="top">
                                            <div id="DataTables_Table_0_filter" class="dataTables_filter">
{#                                            <label>#}
{#                                                搜索:<input type="search"  v-model="search_key"   class="form-control input-sm" placeholder="输入用户名/编号/手机号开始搜索" aria-controls="DataTables_Table_0" @keydown.enter="submit">#}
{#                                            </label>#}
                                        </div>
                                        <div class="clear"></div>
                                        </div>

                                        <table  class="datatable table table-striped dataTable " cellspacing="0" width="100%" id="DataTables_Table_0" role="grid" aria-describedby="DataTables_Table_0_info" style="width: 100%;">
                                        <thead>
                                            <tr role="row">
                                                <th class="sorting_asc" >姓名</th>
                                                <th class="sorting"   >会员号</th>
                                                <th class="sorting"   >会员手机</th>
                                                <th class="sorting"  >会员生日</th>
                                                <th class="sorting"  >会员地址</th>
                                                <th class="sorting"  >会员年龄</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        <tr role="row" class="odd">
                                            {% verbatim myblock %}
                                                 <tr v-for = 'itme in up_date' class="o_hide" :class="{o_show:up_date}">
                                                      <td>
                                                         {{ itme.user_name }}
                                                      </td>
                                                      <td>
                                                         {{ itme.user_num }}
                                                      </td>
                                                      <td>
                                                         {{ itme.user_phone }}
                                                      </td>

                                                     <td>
                                                         {{ itme.user_birth }}
                                                      </td>
                                                      <td>
                                                         {{ itme.user_address }}
                                                      </td>
                                                     <td>
                                                         {{ itme.user_age }}
                                                      </td>
                                                 </tr>
                                                 <tr v-if="!up_date">
                                                    <td class="sorting_1" colspan="6" style="text-align: center">暂无上传的数据</td>
                                                 </tr>
                                            {% endverbatim myblock %}

                                        </tbody>
                                    </table>
                                    <div class="loading" :class="{loading_hide:search_end}">
                                        <i class="fa fa-spinner fa-pulse fa-3x"></i>
                                    </div>
                                    <div class="bottom" style="border-top:1px solid #EAEAEA">
{#                                            <div class="dataTables_paginate paging_simple_numbers" id="DataTables_Table_0_paginate" style="text-align:right">#}
{#                                            <ul class="pagination">#}
{#                                                {% if current_data.has_previous %}#}
{#                                                <li class="paginate_button previous " id="DataTables_Table_0_previous">#}
{#                                                <a href="?page={{ current_data.previous_page_number }}" >上一页</a>#}
{#                                                </li>#}
{#                                                {% else %}#}
{#                                                    <li class="paginate_button previous disabled" id="DataTables_Table_0_previous">#}
{#                                                    <span >上一页</span>#}
{#                                                    </li>#}
{#                                                {% endif %}#}
{#                                                {% for index in paginator.page_range %}#}
{#                                                    {% if index == current_data.number %}#}
                    {#                                    获取当前选择的页面的页码#}
{#                                                        <li class="paginate_button active">#}
{#                                                            <a href="?page={{ index }}">{{ index }}</a>#}
{#                                                        </li>#}
{#                                                    {% else %}#}
{#                                                        <li class="paginate_button ">#}
{#                                                            <a href="?page={{ index }}" >{{ index }}</a>#}
{#                                                        </li>#}
{#                                                    {% endif %}#}
{#                                                {% endfor %}#}
{#                                                {% if current_data.has_next %}#}
{#                                                <li class="paginate_button next" id="DataTables_Table_0_next">#}
{#                                                    <a href="?page={{ current_data.next_page_number }}" >下一页</a>#}
{#                                                </li>#}
{#                                                {% else %}#}
{#                                                    <li class="paginate_button next disabled" id="DataTables_Table_0_next">#}
{#                                                    <span >下一页</span>#}
{#                                                    </li>#}
{#                                                {% endif %}#}
{#                                            </ul>#}
{#                                            </div>#}
{#                                         <div class="clear"></div>#}
                                    </div>
                                     <div class="card-body my_card">
                                         <h5>请选择cvs文件上传</h5><button type="button" class="btn btn-info" @click="up_click">上传文件</button>
                                         <button type="button" class="btn btn-info" @click="upload">保存文件</button>
                                         <input type="file" id="exampleInputFile" name="file" @change='onUpload' style=" width: 0px;height: 0px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <footer class="app-footer">
                <div class="wrapper">
                    <span class="pull-right">1.0 <a href="#"><i class="fa fa-long-arrow-up"></i></a></span> © 2017 Copyright. More Templates <a href="" target="_blank" title="模板之家">东方女人</a>
                </div>
            </footer>
        </div>
</div>
{% endblock %}
{% block model_script %}
    <script type="text/javascript" src="{% static 'js/wrappers.js' %}"></script>
{% endblock %}
{% block script %}
    <script type="text/javascript">
        $(function(){
            var csrf_token='{{ csrf_token }}';
            var save_data = '';

             var myapp = new Vue({
                 el: '#vue',
                 data:{
                    search_key:'',
                    up_date:'',
                    search_end:true,
                    is_search:false,
                    is_ok:false
                 },
                 methods:{
                    onUpload:function(e){
                        var  up = $("#exampleInputFile");
                        var formData = new FormData();
                        formData.append("csrfmiddlewaretoken", csrf_token);
                        formData.append("file", up.get(0).files[0]);
                        var url ='{% url 'users:my_file' %}';
                        var type='post';
                        var data = formData;
                        var func= function(data){
                            //将值传入vue中
                            if (data.code===200){
                                save_data = data.data;
                                myapp.up_date = save_data;
                                myapp.is_ok = true;
                                $(".my_card h5").html('已经选择'+up.get(0).files[0].name+',点击保存上传');
                            }else{
                                alert(data.data)
                            }

                        };
                        my_ajax(url,type,data,func,true)
                    },
                    up_click:function (e) {
                        $('#exampleInputFile').click()
                    },
                    upload:function(e){
                        //todo 添加filename
                        if(this.is_ok){
                            var url = '{% url 'users:save_csv' %}';
                            var type = 'post';
                            var data = re_data(JSON.stringify(save_data),csrf_token);
                            console.log(data);
                            var func=function(data){

                            };
                            my_ajax(url,type,data,func)
                        }else{
                            alert('请选择文件上传')
                        }

                    }
                 }
             })
        })
    </script>
{% endblock %}